<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Registration - Sanskrit Football Tournament</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #1a5e1a;
            --secondary: #d4af37;
            --accent: #c62828;
            --light: #f5f5f5;
            --dark: #0d3d0d;
            --success: #4CAF50;
            --warning: #FF9800;
        }

        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
            color: var(--light);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: rgba(0, 0, 0, 0.7);
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 15px;
            animation: slideDown 0.8s ease-out;
            border: 2px solid var(--secondary);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .title {
            font-size: 2.5rem;
            background: linear-gradient(to right, var(--secondary), #fff, var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .live-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .stat-badge {
            background: rgba(212, 175, 55, 0.2);
            padding: 10px 20px;
            border-radius: 25px;
            border: 1px solid var(--secondary);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
        }

        .stat-badge i {
            color: var(--secondary);
        }

        .registration-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            animation: fadeInUp 0.8s ease-out;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .registration-section h2 {
            color: var(--secondary);
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .instructions {
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid var(--secondary);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            position: relative;
        }

        .instructions h3 {
            color: var(--secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instructions ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .instructions li {
            margin-bottom: 8px;
            position: relative;
        }

        .instructions li:before {
            content: "•";
            color: var(--secondary);
            font-weight: bold;
            position: absolute;
            left: -15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary);
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--secondary);
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }

        .player-section {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .player-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .player-counter {
            background: var(--secondary);
            color: var(--primary);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .player-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
            align-items: end;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .player-row:hover {
            background: rgba(255,255,255,0.05);
        }

        .player-row.required {
            border-left: 3px solid var(--secondary);
        }

        .submit-btn {
            background: linear-gradient(135deg, var(--secondary), #e6c44c);
            color: var(--primary);
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .submit-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }

        .submit-btn:hover:before {
            left: 100%;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .submit-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .message {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            animation: slideIn 0.5s ease-out;
            display: none;
            border-left: 4px solid;
        }

        .success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid var(--success);
            color: #a3d8a3;
            border-left-color: var(--success);
        }

        .error {
            background: rgba(198, 40, 40, 0.2);
            border: 1px solid var(--accent);
            color: #ffa3a3;
            border-left-color: var(--accent);
        }

        .warning {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid var(--warning);
            color: #ffd699;
            border-left-color: var(--warning);
        }

        .progress-bar {
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--secondary);
            border-radius: 2px;
            transition: width 0.3s ease;
            width: 0%;
        }

        footer {
            background: rgba(0, 0, 0, 0.7);
            padding: 25px;
            text-align: center;
            border-radius: 10px;
            margin-top: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .contact-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.3s ease;
        }

        .contact-item:hover {
            transform: scale(1.05);
        }

        .contact-item i {
            color: var(--secondary);
        }

        /* Pop-up Notification Styles */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .popup-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .popup-content {
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
            border: 2px solid var(--secondary);
            transform: scale(0.9);
            transition: transform 0.3s ease;
            position: relative;
        }

        .popup-overlay.active .popup-content {
            transform: scale(1);
        }

        .popup-icon {
            font-size: 4rem;
            color: var(--secondary);
            margin-bottom: 20px;
            animation: bounce 1s ease;
        }

        .popup-title {
            font-size: 1.8rem;
            color: var(--secondary);
            margin-bottom: 15px;
        }

        .popup-message {
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .popup-team-id {
            background: rgba(212, 175, 55, 0.2);
            padding: 10px 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
            border: 1px solid var(--secondary);
        }

        .popup-close-btn {
            background: var(--secondary);
            color: var(--primary);
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .popup-close-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-15px);
            }
            60% {
                transform: translateY(-7px);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @media (max-width: 768px) {
            .player-row {
                grid-template-columns: 1fr;
            }
            
            .contact-info {
                flex-direction: column;
                gap: 15px;
            }
            
            .live-stats {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .popup-content {
                padding: 20px;
            }
            
            .popup-title {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 class="title">Sanskrit Football Tournament Registration</h1>
            <p class="subtitle" style="color: #d4af37;">Ottapalam Sub District Sanskrit Football Tournament</p>
            
            <div class="live-stats">
                <div class="stat-badge">
                    <i class="fas fa-users"></i>
                    <span>Total Registered: <span id="totalTeamsCount">4</span></span>
                </div>
                <div class="stat-badge">
                    <i class="fas fa-trophy"></i>
                    <span>UP Teams: <span id="upTeamsCount">4</span></span>
                </div>
                <div class="stat-badge">
                    <i class="fas fa-futbol"></i>
                    <span>HS Teams: <span id="hsTeamsCount">0</span></span>
                </div>
            </div>
        </header>

        <section class="registration-section">
            <h2><i class="fas fa-user-plus"></i> Team Registration</h2>
            
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> Important Instructions</h3>
                <ul>
                    <li>All players must be studying Sanskrit as First Language</li>
                    <li>UP Category: Classes 5-7 | HS Category: Classes 8-10</li>
                    <li>Each team must have 13 players (9 main players and 4 substitutes)</li>
                    <li>Fill each section carefully and correctly.</li>
                    <li>Coach must be a teacher from the same school</li>
                    <li>All fields are mandatory</li>
                    <li>Registration will be automatically synced with tournament organizers</li>
                    <li>Registration last date - November 20.</li>
                    <li>Venue - P.T.M HSS Thrikkadeeri school ground.</li>
                    <li>Reporting time - 9:00 AM</li>
                    <li>Date - December 06 Saturday </li>
                    <li>Changes in Tournament will be governed by the program committee.</li>
                </ul>
            </div>

            <div id="message" class="message success" style="display: none;"><i class="fas fa-check-circle"></i> ✅ Registration submitted successfully! Your team has been registered in the tournament database. Tournament organizers will contact you soon.</div>
            <div class="progress-bar" style="display: none;" id="progressBar">
                <div class="progress-fill" id="progressFill" style="width: 0%; background: var(--secondary);"></div>
            </div>

            <form id="registrationForm">
                <div class="form-group">
                    <label for="category"><i class="fas fa-layer-group"></i> Category *</label>
                    <select id="category" name="category" required onchange="updateSchoolOptions()">
                        <option value="">Select Category</option>
                        <option value="up">UP Category (Classes 5-7)</option>
                        <option value="hs">HS Category (Classes 8-10)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="schoolName"><i class="fas fa-school"></i> School Name *</label>
                    <select id="schoolName" name="schoolName" required disabled>
                        <option value="">Please select a category first</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="teamName"><i class="fas fa-flag"></i> Team Name *</label>
                    <input type="text" id="teamName" name="teamName" required placeholder="Enter team name">
                </div>

                <div class="form-group">
                    <label for="coachName"><i class="fas fa-user-tie"></i> Coach Name *</label>
                    <input type="text" id="coachName" name="coachName" required placeholder="Enter coach's full name">
                </div>

                <div class="form-group">
                    <label for="coachPhone"><i class="fas fa-phone"></i> Coach Phone Number *</label>
                    <input type="tel" id="coachPhone" name="coachPhone" required pattern="[0-9]{10}" placeholder="10-digit mobile number">
                </div>

                <div class="player-section">
                    <div class="player-header">
                        <h3 style="color: var(--secondary); margin: 0;">
                            <i class="fas fa-users"></i> Player Details (Sanskrit 1st Language)
                        </h3>
                        <div class="player-counter" id="playerCounter" style="background: var(--secondary);">0/13 Players</div>
                    </div>
                    <p style="margin-bottom: 20px; color: #ccc; font-size: 0.9rem;">
                        Fill details for all players (13 players required). All players must be studying Sanskrit as First Language.
                    </p>

                    <div id="playersContainer"></div>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn"><i class="fas fa-paper-plane"></i> Register Team</button>
            </form>
        </section>

        <footer>
            <div class="contact-info">
                <div class="contact-item">
                    <i class="fas fa-phone"></i>
                    <span>+91 90489 22948</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-envelope"></i>
                    <span>ashrafpombra@gmail.com</span>
                </div>
                <div class="contact-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Ottapalam, Kerala</span>
                </div>
            </div>
            <div style="font-style: italic; opacity: 0.8; margin-top: 10px;">
                <i class="fas fa-heart" style="color: #e74c3c;"></i> Designed by Fadi.v PTM HSS
            </div>
        </footer>
    </div>

    <!-- Pop-up Notification -->
    <div class="popup-overlay" id="popupOverlay">
        <div class="popup-content">
            <div class="popup-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2 class="popup-title">Registration Successful!</h2>
            <div class="popup-message">
                Your team has been successfully registered for the Sanskrit Football Tournament.
                <div class="popup-team-id" id="popupTeamId">
                    Team ID: <span id="teamIdValue">Loading...</span>
                </div>
                Tournament organizers will contact you soon with further details.
            </div>
            <button class="popup-close-btn" id="popupCloseBtn">Continue</button>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://ggbuhexzigkhpshegtvq.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdnYnVoZXh6aWdraHBzaGVndHZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNDA4MDksImV4cCI6MjA3NzkxNjgwOX0.nvPTmUXIFOJfp875VkNty54HY7d9-871DI-q7pzouWs';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // DOM Elements
        const registrationForm = document.getElementById('registrationForm');
        const messageDiv = document.getElementById('message');
        const categorySelect = document.getElementById('category');
        const schoolSelect = document.getElementById('schoolName');
        const playersContainer = document.getElementById('playersContainer');
        const submitBtn = document.getElementById('submitBtn');
        const playerCounter = document.getElementById('playerCounter');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const totalTeamsCount = document.getElementById('totalTeamsCount');
        const upTeamsCount = document.getElementById('upTeamsCount');
        const hsTeamsCount = document.getElementById('hsTeamsCount');
        
        // Popup elements
        const popupOverlay = document.getElementById('popupOverlay');
        const popupCloseBtn = document.getElementById('popupCloseBtn');
        const teamIdValue = document.getElementById('teamIdValue');

        // Schools data
        const schools = {
            up: [
                "A. M. U. P. S. CHUNANGAD", "A. S. B. S. PERUR", "A. U. P. S. CHERUMUNDASSERY",
                "A. U. P. S. KANNIAMPURAM", "A. U. P. S. KIZHUR", "A. U. P. S. MANISSERY",
                "A. U. P. S. MANNANNUR", "A. U. P. S. PALAKKODE", "A. U. P. S. PANAMANNA",
                "A. U. P. S. VARODE", "A. V. M. H. S. Chunangad", "B. E. M. U. P. S THRIKKDERI",
                "G. H. S. S. Kadambur", "GHS Akalur", "H. S. Ananganadi", "K. M. S. B. S. LAKKIDI",
                "L. S. N. G. H. S. S. Ottapalam", "M. S. V. M. U. P. S. CHUNANGAD",
                "N. S. S. K. P. T. H. S.Ottapalam", "N. V. A. U. P. S. PANAMANNA SOUTH",
                "S. B. S. MEETNA", "S. S. O. H. S. Lakkidi", "T. R. K. H. S.S.Vaniyamkulam",
                "V. K. M. U. P. S. VENGASSERI"
            ],
            hs: [
                "A. V. M. H. S. Chunangad", "G. H. S. S. Kadambur", "GHS Akalur",
                "H. S. Ananganadi", "K. P. S. M. M. V. H. S. S.Varode", "L. S. N. G. H. S. S. Ottapalam",
                "N. S. S. K. P. T. H. S.Ottapalam", "P. T. M. H. S. Thrikkadeeri",
                "S. S. O. H. S. Lakkidi", "T. R. K. H. S.S.Vaniyamkulam"
            ]
        };

        // Initialize the form
        async function initializeForm() {
            // Generate player rows
            generatePlayerRows();

            // Load live stats
            await loadLiveStats();

            // Set up real-time stats updates
            setupRealTimeStats();

            // Set up popup close button
            popupCloseBtn.addEventListener('click', closePopup);
            
            // Close popup when clicking outside
            popupOverlay.addEventListener('click', function(e) {
                if (e.target === popupOverlay) {
                    closePopup();
                }
            });
        }

        // Update school options based on selected category
        function updateSchoolOptions() {
            const category = categorySelect.value;
            
            if (category) {
                // Enable the school select
                schoolSelect.disabled = false;
                
                // Clear existing options
                schoolSelect.innerHTML = '<option value="">Select School</option>';
                
                // Add schools for the selected category
                schools[category].forEach(school => {
                    const option = document.createElement('option');
                    option.value = school;
                    option.textContent = school;
                    schoolSelect.appendChild(option);
                });
            } else {
                // Disable the school select and show placeholder
                schoolSelect.disabled = true;
                schoolSelect.innerHTML = '<option value="">Please select a category first</option>';
            }
        }

        // Show popup notification
        function showPopup(teamId) {
            teamIdValue.textContent = teamId;
            popupOverlay.classList.add('active');
            
            // Prevent scrolling when popup is open
            document.body.style.overflow = 'hidden';
        }

        // Close popup notification
        function closePopup() {
            popupOverlay.classList.remove('active');
            
            // Restore scrolling
            document.body.style.overflow = 'auto';
        }

        // Load live statistics
        async function loadLiveStats() {
            try {
                const { data: upTeams, error: upError } = await supabase
                    .from('teams')
                    .select('id')
                    .eq('category', 'up');

                const { data: hsTeams, error: hsError } = await supabase
                    .from('teams')
                    .select('id')
                    .eq('category', 'hs');

                if (!upError && !hsError) {
                    const upCount = upTeams ? upTeams.length : 0;
                    const hsCount = hsTeams ? hsTeams.length : 0;
                    const totalCount = upCount + hsCount;

                    totalTeamsCount.textContent = totalCount;
                    upTeamsCount.textContent = upCount;
                    hsTeamsCount.textContent = hsCount;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Set up real-time stats updates
        function setupRealTimeStats() {
            // Subscribe to teams table changes
            supabase
                .channel('teams-stats')
                .on(
                    'postgres_changes',
                    {
                        event: '*',
                        schema: 'public',
                        table: 'teams'
                    },
                    (payload) => {
                        loadLiveStats();
                    }
                )
                .subscribe();
        }

        // Generate player rows
        function generatePlayerRows() {
            playersContainer.innerHTML = '';
            for (let i = 1; i <= 13; i++) {
                const playerRow = document.createElement('div');
                playerRow.className = `player-row required`;
                playerRow.innerHTML = `
                    <div class="form-group">
                        <label for="player${i}_name">Player ${i} Name *</label>
                        <input type="text" id="player${i}_name" name="player${i}_name" required 
                            placeholder="Full name" oninput="updatePlayerCounter()">
                    </div>
                    <div class="form-group">
                        <label for="player${i}_regno">Registration No *</label>
                        <input type="text" id="player${i}_regno" name="player${i}_regno" required 
                            placeholder="School Admission no" oninput="updatePlayerCounter()">
                    </div>
                    <div class="form-group">
                        <label for="player${i}_class">Class *</label>
                        <input type="text" id="player${i}_class" name="player${i}_class" required 
                            placeholder="Class studying" oninput="updatePlayerCounter()">
                    </div>
                `;
                playersContainer.appendChild(playerRow);
            }
            updatePlayerCounter();
        }

        // Update player counter
        function updatePlayerCounter() {
            let filledPlayers = 0;
            for (let i = 1; i <= 13; i++) {
                const nameInput = document.getElementById(`player${i}_name`);
                if (nameInput && nameInput.value.trim()) {
                    filledPlayers++;
                }
            }
            playerCounter.textContent = `${filledPlayers}/13 Players`;
            
            // Update progress bar
            const progress = (filledPlayers / 13) * 100;
            progressFill.style.width = `${progress}%`;
            
            // Show/hide progress bar
            if (filledPlayers > 0) {
                progressBar.style.display = 'block';
            } else {
                progressBar.style.display = 'none';
            }
            
            // Change color based on progress
            if (filledPlayers >= 7) {
                playerCounter.style.background = 'var(--success)';
                progressFill.style.background = 'var(--success)';
            } else if (filledPlayers >= 4) {
                playerCounter.style.background = 'var(--warning)';
                progressFill.style.background = 'var(--warning)';
            } else {
                playerCounter.style.background = 'var(--secondary)';
                progressFill.style.background = 'var(--secondary)';
            }
        }

        // Show message
        function showMessage(message, type) {
            messageDiv.innerHTML = `<i class="fas fa-${getIconName(type)}"></i> ${message}`;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            // Auto-hide success messages after 5 seconds
            if (type === 'success') {
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 5000);
            }
        }

        // Get icon name based on message type
        function getIconName(type) {
            switch(type) {
                case 'success': return 'check-circle';
                case 'error': return 'exclamation-circle';
                case 'warning': return 'exclamation-triangle';
                default: return 'info-circle';
            }
        }

        // Submit to Supabase
        async function submitToSupabase(data) {
            try {
                // Show progress
                progressBar.style.display = 'block';
                progressFill.style.width = '30%';

                // First, insert the team
                const { data: teamData, error: teamError } = await supabase
                    .from('teams')
                    .insert({
                        team_name: data.teamName,
                        school_name: data.schoolName,
                        category: data.category,
                        coach_name: data.coachName,
                        coach_phone: data.coachPhone,
                        submission_time: new Date().toISOString()
                    })
                    .select()
                    .single();

                if (teamError) throw teamError;

                progressFill.style.width = '60%';

                // Then, insert all players
                const players = [];
                for (let i = 1; i <= 13; i++) {
                    if (data[`player${i}_name`] && data[`player${i}_name`].trim()) {
                        players.push({
                            team_id: teamData.id,
                            player_name: data[`player${i}_name`],
                            registration_no: data[`player${i}_regno`],
                            class: data[`player${i}_class`],
                            player_number: i
                        });
                    }
                }

                if (players.length > 0) {
                    const { error: playersError } = await supabase
                        .from('players')
                        .insert(players);

                    if (playersError) throw playersError;
                }

                progressFill.style.width = '100%';

                return { success: true, teamId: teamData.id };
                
            } catch (error) {
                console.error('Error submitting to Supabase:', error);
                return { success: false, error: error.message };
            }
        }

        // Validate form data
        function validateFormData(data) {
            // Check if ALL 13 players are filled
            let playerCount = 0;
            let emptyPlayers = [];
            
            for (let i = 1; i <= 13; i++) {
                if (data[`player${i}_name`] && data[`player${i}_name`].trim()) {
                    playerCount++;
                } else {
                    emptyPlayers.push(i);
                }
            }
            
            if (playerCount < 13) {
                return { 
                    valid: false, 
                    message: `All 13 players are required. Missing players: ${emptyPlayers.join(', ')}` 
                };
            }
            
            // Validate phone number
            const phoneRegex = /^[0-9]{10}$/;
            if (!phoneRegex.test(data.coachPhone)) {
                return { valid: false, message: 'Please enter a valid 10-digit phone number' };
            }
            
            return { valid: true };
        }

        // Submit form
        registrationForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData);
            
            // Validate form data
            const validation = validateFormData(data);
            if (!validation.valid) {
                showMessage(validation.message, 'error');
                return;
            }
            
            // Disable submit button
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Registering Team...';
            
            try {
                // Submit to Supabase
                const result = await submitToSupabase(data);
                
                if (result.success) {
                    // Show the popup notification with the team ID
                    showPopup(result.teamId);
                    
                    // Also show the inline success message
                    showMessage('✅ Registration submitted successfully! Your team has been registered in the tournament database. Tournament organizers will contact you soon.', 'success');
                    
                    // Reset the form
                    registrationForm.reset();
                    generatePlayerRows();
                    updateSchoolOptions(); // Reset school options
                    
                    // Reload stats to update counters
                    await loadLiveStats();
                } else {
                    throw new Error(result.error);
                }
                
            } catch (error) {
                console.error('Error submitting form:', error);
                showMessage('❌ Error submitting registration. Please check your connection and try again.', 'error');
            } finally {
                // Re-enable submit button
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Register Team';
                
                // Hide progress bar
                setTimeout(() => {
                    progressBar.style.display = 'none';
                    progressFill.style.width = '0%';
                }, 1000);
            }
        });

        // Initialize the form when page loads
        document.addEventListener('DOMContentLoaded', initializeForm);
    </script>
</body>

</html>
